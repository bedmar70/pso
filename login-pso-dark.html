<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PSO Access Terminal | Login</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            'display': ['Orbitron', 'sans-serif'],
            'body': ['Rajdhani', 'sans-serif'],
          },
          colors: {
            neon: {
              cyan: '#00f3ff',
              pink: '#bc13fe',
              bg: '#050505'
            }
          },
          boxShadow: {
            'neon-cyan': '0 0 10px rgba(0, 243, 255, 0.5), 0 0 20px rgba(0, 243, 255, 0.3)',
            'neon-pink': '0 0 10px rgba(188, 19, 254, 0.5), 0 0 20px rgba(188, 19, 254, 0.3)',
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 6s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-20px)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    body {
      background-color: #020204;
      background-image: 
        linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
      background-size: 30px 30px;
      color: #e2e8f0;
      overflow: hidden; /* Evitar scroll en login */
    }

    .glass-panel {
      background: rgba(10, 10, 15, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 50px rgba(0,0,0,0.5);
    }

    .cyber-input {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid #333;
      color: #00f3ff;
      transition: all 0.3s ease;
      letter-spacing: 1px;
    }
    .cyber-input:focus {
      border-color: #00f3ff;
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
      outline: none;
    }
    
    .loader-ring {
      border: 2px solid rgba(0,0,0,0.1);
      border-left-color: #000;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="font-body h-screen flex items-center justify-center relative">

  <div class="fixed top-0 left-0 w-full h-full pointer-events-none z-0">
    <div class="absolute top-[10%] left-[20%] w-[300px] h-[300px] bg-neon-cyan opacity-20 blur-[100px] rounded-full animate-pulse-slow"></div>
    <div class="absolute bottom-[10%] right-[20%] w-[400px] h-[400px] bg-neon-pink opacity-10 blur-[120px] rounded-full animate-pulse-slow"></div>
  </div>

  <div class="glass-panel w-full max-w-md rounded-2xl p-8 md:p-10 relative z-10 border-t border-white/10 animate-float">
    
    <div class="text-center mb-10">
      <div class="inline-block p-4 rounded-full border border-neon-cyan/30 bg-neon-cyan/5 mb-4 shadow-neon-cyan">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-neon-cyan" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
      </div>
      <h1 class="font-display text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400 tracking-wider">
        PSO <span class="text-neon-cyan">ACCESS</span>
      </h1>
      <p class="text-neon-pink text-xs tracking-[0.2em] mt-2 uppercase opacity-80">Terminal de Gestión Comercial</p>
    </div>

    <form id="loginForm" class="space-y-6">
      
      <div class="space-y-2">
        <label for="email" class="text-xs font-bold text-gray-400 uppercase tracking-widest ml-1">Identificador (Email)</label>
        <div class="relative group">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-500 group-hover:text-neon-cyan transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
            </svg>
          </div>
          <input type="email" id="email" required autocomplete="email" class="cyber-input w-full rounded-lg py-3 pl-10 pr-4 text-sm focus:bg-black/50" placeholder="agente@pso.com">
        </div>
      </div>

      <div class="space-y-2">
        <label for="password" class="text-xs font-bold text-gray-400 uppercase tracking-widest ml-1">Clave de Acceso</label>
        <div class="relative group">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-500 group-hover:text-neon-cyan transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
            </svg>
          </div>
          <input type="password" id="password" required autocomplete="current-password" class="cyber-input w-full rounded-lg py-3 pl-10 pr-4 text-sm focus:bg-black/50" placeholder="••••••••">
        </div>
      </div>

      <button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-neon-cyan to-blue-600 text-black font-display font-black text-sm py-4 rounded-xl shadow-neon-cyan hover:scale-[1.02] hover:shadow-lg transition-all mt-8 uppercase tracking-widest group relative overflow-hidden">
        <span class="relative z-10 flex items-center justify-center gap-2">
          Inicializar Sesión
          <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
        </span>
      </button>

    </form>

    <div class="mt-8 text-center">
      <p class="text-[10px] text-gray-600 font-mono">
        SECURE CONNECTION :: N8N GATEWAY v2.5.0<br>
        ACCESO RESTRINGIDO A PERSONAL AUTORIZADO
      </p>
    </div>

  </div>


  <script>
    const CONFIG = {
      // Tu webhook original de login
      webhookLogin: 'https://n8n.escueladeefectividad.com/webhook/pso-login-comerciales',
      // Redirección interna al formulario futurista
      formularioUrl: 'formulario-pso-seguro-completo.html' 
    };

    const form = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    // 1. Verificar si ya hay sesión activa
    (function checkSession() {
      const sessionExistente = localStorage.getItem('pso_user_session');
      if (sessionExistente) {
        try {
          JSON.parse(sessionExistente);
          // Si existe sesión válida, redirigir instantáneamente
          window.location.href = CONFIG.formularioUrl;
        } catch (e) {
          localStorage.removeItem('pso_user_session');
        }
      }
    })();

    // 2. Manejar Submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      if (!email || !password) return;

      // UI Loading
      loginBtn.disabled = true;
      const originalBtnContent = loginBtn.innerHTML;
      loginBtn.innerHTML = '<span class="flex items-center justify-center gap-2"><div class="loader-ring"></div> VERIFICANDO CREDENCIALES...</span>';
      
      // Simular delay tecnológico (opcional, da sensación de proceso)
      // await new Promise(r => setTimeout(r, 800)); 

      try {
        const response = await fetch(CONFIG.webhookLogin, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (data.success) {
          // LOGIN EXITOSO
          
          const session = {
            nombre: data.usuario.nombre,
            email: data.usuario.email,
            esVip: data.usuario.esVip,
            esComercial: data.usuario.esComercial,
            loginTimestamp: new Date().toISOString()
          };

          localStorage.setItem('pso_user_session', JSON.stringify(session));

          // Alerta bonita de éxito
          const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 1500,
            timerProgressBar: true,
            background: '#0a0a0a',
            color: '#00f3ff',
            iconColor: '#00f3ff'
          });

          Toast.fire({
            icon: 'success',
            title: `Bienvenido, ${data.usuario.nombre}`
          });

          // Redirección tras la animación
          setTimeout(() => {
            window.location.href = CONFIG.formularioUrl;
          }, 1500);

        } else {
          // LOGIN FALLIDO (Password incorrecto)
          throw new Error(data.mensaje || 'Credenciales inválidas');
        }

      } catch (error) {
        console.error('Error:', error);
        
        // Alerta bonita de error
        Swal.fire({
          title: 'ACCESO DENEGADO',
          text: error.message || 'Error de conexión con el servidor.',
          icon: 'error',
          background: '#0a0a0a',
          color: '#fff',
          confirmButtonColor: '#e11d48',
          confirmButtonText: 'REINTENTAR'
        });

        loginBtn.disabled = false;
        loginBtn.innerHTML = originalBtnContent;
        passwordInput.value = '';
        passwordInput.focus();
      }
    });
  </script>
</body>
</html>